<!DOCTYPE html>
<html>
<head>
<style>
    table,th,td    {height:20px;
                text-align:center;
                width: 100px;
//                border: 1px solid black;
                vertical-align: top}

    th          {font-size: 150%%;
                font-weight: normal}

    .results    {border: 1px solid black;
                border-collapse:collapse}
    .resultTitle{border: 1px solid black;
                border-collapse:collapse;
                font-weight: bold}

</style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>
    function addQuerySet(set){
        var queries = document.getElementById("queries");
        if (set.checked){
            switch(set.value){
                case "sulfides":
                    str=''
                    for (var i=0; i<sulfides.length;i++){
                        str += sulfides[i]+', ';
                    } queries.value += str;
                    break;
                case "selenides":
                    str=''
                    for (var i=0; i<selenides.length;i++){
                        str += selenides[i]+', ';
                    } queries.value += str;
                    break;
                case "twoMetals":
                    str=''
                    for (var i=0; i<twoMetals.length;i++){
                        str += twoMetals[i]+', ';
                    } queries.value += str;
                    break;
                case "oxides":
                    str=''
                    for (var i=0; i<oxides.length;i++){
                        str += oxides[i]+', ';
                    } queries.value += str;
                    break;
            }
        } else {
            switch(set.value){
                case "sulfides":
                    for (var i=0; i<sulfides.length; i++){
                        queries.value = queries.value.replace(sulfides[i]+', ',"");
                    }break;
                case "selenides":
                    for (var i=0; i<selenides.length; i++){
                        queries.value = queries.value.replace(selenides[i]+', ',"");
                    }break;
                case "twoMetals":
                    for (var i=0; i<twoMetals.length; i++){
                        queries.value = queries.value.replace(twoMetals[i]+', ',"");
                    }break;
                case "oxides":
                    for (var i=0; i<oxides.length; i++){
                        queries.value = queries.value.replace(oxides[i]+', ',"");
                    }break;
            }

        }
    }

    function addPermSet(chem){
        var d = document.getElementsByName("3d");
        var chal = document.getElementsByName("chal");
        var ae = document.getElementsByName("ae");

        var ds = [], chals = [], aes = [];

        for (var i = 0; i < d.length; i++) {
            if (d[i].checked){
                ds.push(d[i]);
            }
        }
        for (var i = 0; i < chal.length; i++) {
            if (chal[i].checked){
                chals.push(chal[i]);
            }
        }
        for (var i = 0; i < ae.length; i++) {
            if (ae[i].checked){
                aes.push(ae[i]);
            }
        }

        if (chem.name=="3d"){
            ds=[chem];
        } else if (chem.name=="chal"){
            chals=[chem];
        } else if (chem.name="ae"){
            aes=[chem];
        };

        change=[];

        for (var i = 0; i < ds.length; i++) {
            for (var j = 0; j<chals.length; j++) {
                for (var k = 0; k<aes.length; k++) {
                    change.push('['+ds[i].value+','+chals[j].value+','+aes[k].value+']');
                }
            }
        }

        var queries = document.getElementById("queries");
        if (chem.checked){
            for (var i = 0; i<change.length; i++){
                queries.value+=change[i]+', ';
            }
        } else {
            for (var i = 0; i<change.length; i++){
                queries.value = queries.value.replace(change[i]+', ','');
            }
        }
    }

    function resetKeyDefault(){
        document.getElementById("keywords").value=''
        for (var i = 0; i<keywords.length; i++) {
            document.getElementById("keywords").value += keywords[i] + ', ';
        }
    }

    $(document).ready(function() {
        $.get("materialsSearch_Serv.py", {set:'sulfides'}, function(data){
            sulfides=data.split("', '");
        });
        $.get("materialsSearch_Serv.py", {set:'selenides'}, function(data){
            selenides=data.split("', '");
        });
        $.get("materialsSearch_Serv.py", {set:'twoMetals'}, function(data){
            twoMetals=data.split("', '");
        });
        $.get("materialsSearch_Serv.py", {set:'oxides'}, function(data){
            oxides=data.split("', '");
        });
        $.get("materialsSearch_Serv.py", {set:'keywords'}, function(data){
            keywords=data.split("', '");
        });

        $('#showmp').click(function(){
            if ($(this).text()=='Display MP Results'){
                $(this).text('Hide MP Results');
            } else {
                $(this).text('Display MP Results');
            };
            $('#mpresults').toggle(500)
        });

        $('#showwok').click(function(){
            if ($(this).text()=='Display WoK Results'){
                $(this).text('Hide WoK Results');
            } else {
                $(this).text('Display WoK Results');
            };
            $('#wokresults').toggle(500)
        });

        $('#mpbutton, #wokbutton, #csvbutton').click(function(event) {
            $('#response').empty().append('Generating results... Please wait...');

            url = $('#ajaxform').attr( "action" );

            event.preventDefault();

            var posting = $.post(url,{
                queries:$('[name="queries"]').val(),
                keywords:$('[name="keywords"]').val(),
                name:$('[name="searchname"]').val(),
                searchlimit:$('[name="searchlimit"]').val(),
                searchtype:$(this).val()});

            posting.done(function(data){
                $('#response').empty().append('Done!');

                if (event.target.id == 'mpbutton'){
                    $("#mpresults > tbody").empty().append(data);
                } else if (event.target.id == 'wokbutton') {
                    result = JSON.parse(data)
                    $("#wokresults > thead > tr").empty().append(result[0])
                    $("#wokresults > tbody").empty().append(result[1]);
                }
            });
        });
    });
</script>
</head>

<body>
<h1><u>Materials Search</u></h1>

<p>Searches <i>Materials Project</i> and <i>Web of Knowledge</i> for relevant data with respect to finding promising
    new candidates for superconductivity.</p>

<hr>
<form method="post" action="materialsSearch_Serv.py" id="ajaxform">
    <table style="width:100%%">
        <tr>
            <th colspan="6" style="text-align: left">Queries: </th>
        </tr>
        <tr>
            <td colspan="6" style="text-align: left">Add chemical formulas to materials search query list seperated by
                a comma and a space", ". Click the checkboxes to add preset material sets or to check <i>Materials Project</i>
                for permutations of elements.</td>
        </tr>
        <tr style="height: 10px"></tr>
        <tr>
            <td style="width:10px"></td>
            <td style="width:130px; text-align: left">Add sets:</td>
            <td colspan="4" style="text-align: left">
                <input type="checkbox" value="sulfides" onchange="addQuerySet(this)">sulfides
                <input type="checkbox" value="selenides" onchange="addQuerySet(this)">selenides
                <input type="checkbox" value="twoMetals" onchange="addQuerySet(this)">two metals
                <input type="checkbox" value="oxides" onchange="addQuerySet(this)">oxides
            </td>
        </tr>
        <tr>
            <td style="width:10px"></td>
            <td style="width:130px; text-align: left">Add Permutations: </td>
            <td><u>3d Orbitals</u></td>
            <td><u>Chalcogen</u></td>
            <td><u>Alkaline Earth</u></td>
            <td style="width: auto"></td>
        </tr>
        <tr>
            <td colspan="2"></td>
            <td>
                <input type="checkbox" name="3d" value="V" onchange="addPermSet(this)">V<br>
                <input type="checkbox" name="3d" value="Cr" onchange="addPermSet(this)">Cr<br>
                <input type="checkbox" name="3d" value="Mn" onchange="addPermSet(this)">Mn<br>
                <input type="checkbox" name="3d" value="Fe" onchange="addPermSet(this)">Fe<br>
                <input type="checkbox" name="3d" value="Co" onchange="addPermSet(this)">Co<br>
                <input type="checkbox" name="3d" value="Ni" onchange="addPermSet(this)">Ni<br>
                <input type="checkbox" name="3d" value="Cu" onchange="addPermSet(this)">Cu<br>
            </td>
            <td>
                <input type="checkbox" name="chal" value="Se" onchange="addPermSet(this)">Se<br>
                <input type="checkbox" name="chal" value="S" onchange="addPermSet(this)">S<br>
                <input type="checkbox" name="chal" value="O" onchange="addPermSet(this)">O<br>
            </td>
            <td>
                <input type="checkbox" name="ae" value="La" onchange="addPermSet(this)">La<br>
                <input type="checkbox" name="ae" value="Sr" onchange="addPermSet(this)">Sr<br>
                <input type="checkbox" name="ae" value="Ba" onchange="addPermSet(this)">Ba<br>
                <input type="checkbox" name="ae" value="Ca" onchange="addPermSet(this)">Ca<br>
                <input type="checkbox" name="ae" value="K" onchange="addPermSet(this)">K<br>
                <input type="checkbox" name="ae" value="Y" onchange="addPermSet(this)">Y<br>
            </td>
        </tr>
        <tr>
            <td style="width:10px"></td>
            <td colspan="5" style="text-align:left">
                <textarea name="queries" id="queries" rows="10" cols="60" placeholder="Enter queries here..."></textarea>
            </td>
        </tr>
        <tr style="height:15px"></tr>
        <tr>
            <th colspan="6" style="text-align: left">Keywords: </th>
        </tr>
        <tr>
            <td colspan="6" style="text-align: left">Add keywords to search for in scientific abstracts seperated by a
                comma and a space ", ". For a default list of common relevant keywords, click 'Reset Default' below.</td>
        </tr>
        <tr style="height: 10px"></tr>
        <tr>
            <td style="width:10px"></td>
            <td colspan="5" style="text-align:left">
                <textarea name="keywords" id="keywords" rows="10" cols="60" placeholder="Enter keywords here..."></textarea>
            </td>
        </tr>
        <tr>
            <td style="width:10px"></td>
            <td colspan="2">
                <button id="keyDefault" type="button" onclick="resetKeyDefault()">Reset Default</button>
            </td>
        </tr>
        <tr style="height:25px"></tr>
        <tr style="height:25px">
            <td colspan="4" style="text-align:left">Enter a name for this search: <input type="text" name="searchname"></td>
            <td colspan="2" style="text-align:left">Search limit: <input type="number" name="searchlimit" value="50"></td>
        </tr>
        <tr style="height:25px"></tr>
        <tr>
            <td style="width:5px"></td>
            <td colspan="5" style="text-align:left">
                <button type="submit" id="mpbutton" value="mp">Search MP</button>
                <button type="submit" id="wokbutton" value="wok">Search WoK</button>
                <button type="submit" id="csvbutton" value="csv">Generate CSVs and WCs</button>
            </td>
        </tr>
    </table>
</form>
<hr>
<div>
    <h2>Results:</h2>
    <p id="response">Server Status</p>
    <button id="showmp">Display MP Results</button><button id="showwok">Display WoK Results</button>
    <table class="results" id="mpresults" style="width:100%; display:none">
        <thead>
        <tr class="results">
            <td class="resultTitle">Formula</td><td class="resultTitle">Full Formula</td><td class="resultTitle">Total Magnetization</td>
            <td class="resultTitle">Formation Energy (eV)</td><td class="resultTitle">E Above Hull (eV)</td><td class="resultTitle">Band Gap (eV)</td>
            <td class="resultTitle">Nsites</td><td class="resultTitle">Density (gm/cc)</td><td class="resultTitle">Volume</td><td class="resultTitle">Spacegroup</td><td class="resultTitle">CIF</td>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <table class="results" id="wokresults" style="display:none">
        <thead>
        <tr class="results">

        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
</div>

<hr>


</body>
</html>
         